FROM mariadb:10.11-jammy

# Copy custom MariaDB configuration
COPY ./conf/my.cnf /etc/mysql/conf.d/custom.cnf

# Copy initialization script
COPY ./tools/init-db.sh /docker-entrypoint-initdb.d/

# Set permissions
RUN chmod 644 /etc/mysql/conf.d/custom.cnf && \
    chmod +x /docker-entrypoint-initdb.d/init-db.sh

# Create mysql user with specific UID for consistency
RUN groupadd -g 999 mysql && \
    useradd -u 999 -g mysql mysql && \
    chown -R mysql:mysql /var/lib/mysql

USER mysql
